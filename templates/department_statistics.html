{% extends "base.html" %}

{% block title %}éƒ¨é–€åˆ¥è©³ç´°çµ±è¨ˆ - RCCMè©¦é¨“å•é¡Œé›†{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>ğŸ“ˆ éƒ¨é–€åˆ¥è©³ç´°çµ±è¨ˆåˆ†æ</h2>
                <div>
                    <a href="{{ url_for('statistics') }}" class="btn btn-outline-secondary mr-2">
                        åŸºæœ¬çµ±è¨ˆ
                    </a>
                    <a href="{{ url_for('index') }}" class="btn btn-outline-primary">
                        ãƒ›ãƒ¼ãƒ 
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- æ¦‚è¦çµ±è¨ˆ -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-primary">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">ğŸ“‹ å­¦ç¿’æ¦‚è¦</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="text-center">
                                <h3 class="text-primary">{{ report.overview.total_questions }}</h3>
                                <p class="text-muted">ç·å•é¡Œæ•°</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <h3 class="text-success">{{ "%.1f"|format(report.overview.overall_accuracy * 100) }}%</h3>
                                <p class="text-muted">ç·åˆæ­£ç­”ç‡</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <h3 class="text-info">{{ report.overview.departments_studied }}</h3>
                                <p class="text-muted">å­¦ç¿’éƒ¨é–€æ•°</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <h3 class="text-warning">{{ "%.0f"|format(report.overview.department_coverage * 100) }}%</h3>
                                <p class="text-muted">éƒ¨é–€ã‚«ãƒãƒ¼ç‡</p>
                            </div>
                        </div>
                    </div>
                    <div class="mt-3">
                        <div class="progress" style="height: 15px;">
                            <div class="progress-bar bg-success" style="width: {{ report.overview.overall_accuracy * 100 }}%"></div>
                        </div>
                        <small class="text-muted mt-1 d-block">{{ report.overview.performance_summary }}</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- éƒ¨é–€åˆ¥è©³ç´°åˆ†æ -->
    {% if report.department_analysis %}
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5>ğŸ¢ éƒ¨é–€åˆ¥æˆç¸¾åˆ†æ</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        {% for dept_id, dept_data in report.department_analysis.items() %}
                        <div class="col-lg-6 col-xl-4 mb-4">
                            <div class="card h-100 border-left" style="border-left-color: {{ dept_data.color }} !important; border-left-width: 4px !important;">
                                <div class="card-header" style="background-color: {{ dept_data.color }}; color: white;">
                                    <h6 class="mb-0">
                                        {{ dept_data.icon }} {{ dept_data.name }}
                                        <span class="badge badge-light float-right">{{ dept_data.performance_grade }}</span>
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <!-- åŸºæœ¬æˆç¸¾ -->
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between">
                                            <span>æ­£ç­”ç‡:</span>
                                            <strong>{{ "%.1f"|format(dept_data.accuracy * 100) }}%</strong>
                                        </div>
                                        <div class="progress mt-1" style="height: 6px;">
                                            <div class="progress-bar bg-{{ 'success' if dept_data.accuracy > 0.7 else 'warning' if dept_data.accuracy > 0.5 else 'danger' }}" 
                                                 style="width: {{ dept_data.accuracy * 100 }}%"></div>
                                        </div>
                                    </div>
                                    
                                    <!-- è©³ç´°çµ±è¨ˆ -->
                                    <div class="small text-muted">
                                        <div class="d-flex justify-content-between">
                                            <span>å•é¡Œæ•°:</span>
                                            <span>{{ dept_data.total_questions }}å•</span>
                                        </div>
                                        <div class="d-flex justify-content-between">
                                            <span>å¹³å‡æ™‚é–“:</span>
                                            <span>{{ "%.1f"|format(dept_data.avg_time_per_question) }}ç§’</span>
                                        </div>
                                        <div class="d-flex justify-content-between">
                                            <span>æœ€è¿‘ã®æ­£ç­”ç‡:</span>
                                            <span>{{ "%.1f"|format(dept_data.recent_accuracy * 100) }}%</span>
                                        </div>
                                        <div class="d-flex justify-content-between">
                                            <span>ã‚«ãƒãƒ¼åˆ†é‡:</span>
                                            <span>{{ dept_data.categories_covered }}åˆ†é‡</span>
                                        </div>
                                    </div>
                                    
                                    <!-- æ”¹å–„å‚¾å‘ -->
                                    {% if dept_data.improvement_trend > 0.05 %}
                                    <div class="mt-2">
                                        <span class="badge badge-success">
                                            â¬†ï¸ æ”¹å–„ä¸­ (+{{ "%.1f"|format(dept_data.improvement_trend * 100) }}%)
                                        </span>
                                    </div>
                                    {% elif dept_data.improvement_trend < -0.05 %}
                                    <div class="mt-2">
                                        <span class="badge badge-warning">
                                            â¬‡ï¸ è¦æ³¨æ„ ({{ "%.1f"|format(dept_data.improvement_trend * 100) }}%)
                                        </span>
                                    </div>
                                    {% else %}
                                    <div class="mt-2">
                                        <span class="badge badge-info">
                                            â– å®‰å®š
                                        </span>
                                    </div>
                                    {% endif %}
                                    
                                    <!-- å•é¡Œç¨®åˆ¥åˆ¥æˆç¸¾ -->
                                    {% if dept_data.question_type_analysis %}
                                    <div class="mt-3 pt-2 border-top">
                                        <small class="text-muted d-block mb-2">å•é¡Œç¨®åˆ¥åˆ¥æˆç¸¾:</small>
                                        {% for type_id, type_data in dept_data.question_type_analysis.items() %}
                                        <div class="d-flex justify-content-between small">
                                            <span>{{ 'åŸºç¤' if type_id == 'basic' else 'å°‚é–€' if type_id == 'specialist' else type_id }}:</span>
                                            <span>{{ "%.1f"|format(type_data.accuracy * 100) }}% ({{ type_data.total_questions }}å•)</span>
                                        </div>
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                    
                                    <!-- å­¦ç¿’æ¨å¥¨ -->
                                    <div class="mt-3 p-2 bg-light rounded">
                                        <small class="text-muted">
                                            ğŸ’¡ {{ dept_data.study_recommendation }}
                                        </small>
                                    </div>
                                </div>
                                <div class="card-footer">
                                    <a href="{{ url_for('ai_analysis', department=dept_id) }}" class="btn btn-sm btn-outline-primary">
                                        AIåˆ†æ
                                    </a>
                                    <a href="{{ url_for('adaptive_quiz', department=dept_id, mode='department_mastery') }}" class="btn btn-sm btn-outline-success ml-2">
                                        å­¦ç¿’ã‚’å§‹ã‚ã‚‹
                                    </a>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- å•é¡Œç¨®åˆ¥åˆ†æ -->
    {% if report.question_type_analysis %}
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5>ğŸ“š å•é¡Œç¨®åˆ¥åˆ†æï¼ˆ4-1åŸºç¤ vs 4-2å°‚é–€ï¼‰</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        {% for type_id, type_data in report.question_type_analysis.items() %}
                        <div class="col-md-6 mb-3">
                            <div class="card border-{{ 'warning' if type_id == 'basic' else 'success' }}">
                                <div class="card-header bg-{{ 'warning' if type_id == 'basic' else 'success' }} text-white">
                                    <h6 class="mb-0">
                                        {{ type_data.name }}
                                        <span class="badge badge-light float-right">{{ type_data.performance_grade }}</span>
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <span>æ­£ç­”ç‡:</span>
                                            <h5 class="mb-0">{{ "%.1f"|format(type_data.accuracy * 100) }}%</h5>
                                        </div>
                                        <div class="progress mt-2" style="height: 8px;">
                                            <div class="progress-bar bg-{{ 'warning' if type_id == 'basic' else 'success' }}" 
                                                 style="width: {{ type_data.accuracy * 100 }}%"></div>
                                        </div>
                                    </div>
                                    
                                    <div class="small text-muted">
                                        <div class="d-flex justify-content-between">
                                            <span>å•é¡Œæ•°:</span>
                                            <span>{{ type_data.total_questions }}å•</span>
                                        </div>
                                        <div class="d-flex justify-content-between">
                                            <span>å¹³å‡æ™‚é–“:</span>
                                            <span>{{ "%.1f"|format(type_data.avg_time_per_question) }}ç§’</span>
                                        </div>
                                    </div>
                                    
                                    <!-- éƒ¨é–€åˆ¥æˆç¸¾ãƒˆãƒƒãƒ—3 -->
                                    {% if type_data.department_performance %}
                                    <div class="mt-3 pt-2 border-top">
                                        <small class="text-muted d-block mb-2">éƒ¨é–€åˆ¥æˆç¸¾ï¼ˆä¸Šä½3ä½ï¼‰:</small>
                                        {% for dept_id, dept_perf in (type_data.department_performance.items() | list | sort(attribute='1.accuracy', reverse=true))[:3] %}
                                        <div class="d-flex justify-content-between small">
                                            <span>{{ dept_perf.department_name }}</span>
                                            <span>{{ "%.1f"|format(dept_perf.accuracy * 100) }}%</span>
                                        </div>
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                    
                                    <div class="mt-3 p-2 bg-light rounded">
                                        <small class="text-muted">
                                            ğŸ¯ {{ type_data.study_focus }}
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- åŸºç¤â†’å°‚é–€ç›¸é–¢åˆ†æ -->
    {% if report.cross_analysis.basic_specialist_correlations %}
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5>ğŸ”— åŸºç¤â†’å°‚é–€å­¦ç¿’åŠ¹æœåˆ†æ</h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        â„¹ï¸
                        åŸºç¤ç†è§£ï¼ˆ4-1ï¼‰ãŒå°‚é–€æˆç¸¾ï¼ˆ4-2ï¼‰ã«ä¸ãˆã‚‹å½±éŸ¿ã‚’åˆ†æã—ã¾ã™ã€‚æ­£ã®ç›¸é–¢ãŒé«˜ã„ã»ã©ã€åŸºç¤å­¦ç¿’ãŒå°‚é–€æˆç¸¾å‘ä¸Šã«åŠ¹æœçš„ã§ã™ã€‚
                    </div>
                    
                    <div class="row">
                        {% for correlation in report.cross_analysis.basic_specialist_correlations %}
                        <div class="col-md-6 mb-3">
                            <div class="card border-left border-{{ 'success' if correlation.foundation_strength else 'warning' }}" 
                                 style="border-left-width: 4px !important;">
                                <div class="card-body">
                                    <h6>{{ correlation.department_name }}</h6>
                                    
                                    <div class="mb-2">
                                        <div class="d-flex justify-content-between">
                                            <span class="small">åŸºç¤ï¼ˆ4-1ï¼‰:</span>
                                            <span class="badge badge-{{ 'success' if correlation.basic_accuracy > 0.7 else 'warning' }}">
                                                {{ "%.1f"|format(correlation.basic_accuracy * 100) }}%
                                            </span>
                                        </div>
                                        <div class="d-flex justify-content-between">
                                            <span class="small">å°‚é–€ï¼ˆ4-2ï¼‰:</span>
                                            <span class="badge badge-{{ 'success' if correlation.specialist_accuracy > 0.6 else 'warning' }}">
                                                {{ "%.1f"|format(correlation.specialist_accuracy * 100) }}%
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <div class="progress mb-2" style="height: 6px;">
                                        <div class="progress-bar bg-warning" style="width: {{ correlation.basic_accuracy * 100 }}%"></div>
                                    </div>
                                    <div class="progress mb-2" style="height: 6px;">
                                        <div class="progress-bar bg-success" style="width: {{ correlation.specialist_accuracy * 100 }}%"></div>
                                    </div>
                                    
                                    <div class="small text-muted">
                                        <div class="d-flex justify-content-between">
                                            <span>å­¦ç¿’åŠ¹ç‡:</span>
                                            <span>{{ "%.2f"|format(correlation.learning_efficiency) }}</span>
                                        </div>
                                        <div class="d-flex justify-content-between">
                                            <span>ç›¸é–¢:</span>
                                            <span class="text-{{ 'success' if correlation.correlation > 0 else 'danger' }}">
                                                {{ "%.1f"|format(correlation.correlation * 100) }}%
                                            </span>
                                        </div>
                                    </div>
                                    
                                    {% if not correlation.foundation_strength %}
                                    <div class="mt-2">
                                        <small class="text-warning">
                                            âš ï¸ 
                                            åŸºç¤ç†è§£ã®å‘ä¸Šã§å°‚é–€æˆç¸¾ã®å¤§å¹…æ”¹å–„ãŒæœŸå¾…ã§ãã¾ã™
                                        </small>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- å­¦ç¿’åŠ¹ç‡åˆ†æ -->
    {% if report.learning_efficiency %}
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5>âš¡ å­¦ç¿’åŠ¹ç‡åˆ†æ</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="text-center">
                                <h4 class="text-primary">{{ "%.2f"|format(report.learning_efficiency.overall_efficiency_score) }}</h4>
                                <p class="text-muted">åŠ¹ç‡ã‚¹ã‚³ã‚¢ (æ­£ç­”æ•°/åˆ†)</p>
                                <span class="badge badge-{{ 'success' if report.learning_efficiency.overall_efficiency_score > 1.5 else 'warning' if report.learning_efficiency.overall_efficiency_score > 1.0 else 'danger' }}">
                                    {{ report.learning_efficiency.efficiency_grade }}
                                </span>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center">
                                <h4 class="text-info">{{ "%.1f"|format(report.learning_efficiency.avg_time_per_question) }}</h4>
                                <p class="text-muted">å¹³å‡å›ç­”æ™‚é–“ (ç§’)</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center">
                                <h4 class="text-success">{{ "%.1f"|format(report.learning_efficiency.accuracy_rate * 100) }}%</h4>
                                <p class="text-muted">æ­£ç­”ç‡</p>
                            </div>
                        </div>
                    </div>
                    
                    {% if report.learning_efficiency.time_management_advice %}
                    <div class="mt-3 alert alert-light">
                        ğŸ• {{ report.learning_efficiency.time_management_advice }}
                    </div>
                    {% endif %}
                    
                    <!-- éƒ¨é–€åˆ¥åŠ¹ç‡ -->
                    {% if report.learning_efficiency.department_efficiency %}
                    <div class="mt-4">
                        <h6>éƒ¨é–€åˆ¥å­¦ç¿’åŠ¹ç‡:</h6>
                        <div class="row">
                            {% for dept_id, dept_efficiency in report.learning_efficiency.department_efficiency.items() %}
                            <div class="col-md-6 mb-2">
                                <div class="d-flex justify-content-between align-items-center p-2 border rounded">
                                    <span>{{ departments.get(dept_id, {}).get('name', dept_id) }}</span>
                                    <div class="text-right">
                                        <span class="badge badge-primary">{{ "%.2f"|format(dept_efficiency.efficiency_score) }}</span>
                                        <small class="text-muted ml-2">{{ "%.1f"|format(dept_efficiency.avg_time) }}ç§’</small>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- ç¿’ç†Ÿåº¦è©•ä¾¡ -->
    {% if report.mastery_assessment.department_mastery %}
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5>ğŸ… ç¿’ç†Ÿåº¦ãƒ¬ãƒ™ãƒ«è©•ä¾¡</h5>
                </div>
                <div class="card-body">
                    <!-- ç¿’ç†Ÿåº¦ã‚µãƒãƒªãƒ¼ -->
                    {% set mastery_summary = report.mastery_assessment.overall_mastery_summary %}
                    <div class="alert alert-info mb-4">
                        <div class="row">
                            <div class="col-md-8">
                                <h6>ç¿’ç†Ÿåº¦åˆ†å¸ƒ:</h6>
                                {% for level, count in mastery_summary.mastery_distribution.items() %}
                                <span class="badge badge-{{ 'success' if level == 'ä¸Šç´š' else 'warning' if level == 'ä¸­ç´š' else 'secondary' }} mr-2">
                                    {{ level }}: {{ count }}éƒ¨é–€
                                </span>
                                {% endfor %}
                            </div>
                            <div class="col-md-4 text-right">
                                <h6>å­¦ç¿’éƒ¨é–€: {{ mastery_summary.total_departments }}éƒ¨é–€</h6>
                            </div>
                        </div>
                    </div>
                    
                    <!-- éƒ¨é–€åˆ¥ç¿’ç†Ÿåº¦ -->
                    <div class="row">
                        {% for dept_id, mastery_data in report.mastery_assessment.department_mastery.items() %}
                        <div class="col-md-6 col-lg-4 mb-3">
                            <div class="card border-{{ 'success' if mastery_data.mastery_level == 'ä¸Šç´š' else 'warning' if mastery_data.mastery_level == 'ä¸­ç´š' else 'secondary' }}">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <h6>{{ mastery_data.department_name }}</h6>
                                        <span class="badge badge-{{ 'success' if mastery_data.mastery_level == 'ä¸Šç´š' else 'warning' if mastery_data.mastery_level == 'ä¸­ç´š' else 'secondary' }}">
                                            {{ mastery_data.mastery_level }}
                                        </span>
                                    </div>
                                    
                                    <div class="small text-muted">
                                        <div class="d-flex justify-content-between">
                                            <span>ç·åˆæˆç¸¾:</span>
                                            <span>{{ "%.1f"|format(mastery_data.overall_accuracy * 100) }}%</span>
                                        </div>
                                        <div class="d-flex justify-content-between">
                                            <span>æœ€è¿‘ã®æˆç¸¾:</span>
                                            <span>{{ "%.1f"|format(mastery_data.recent_accuracy * 100) }}%</span>
                                        </div>
                                        <div class="d-flex justify-content-between">
                                            <span>å•é¡Œæ•°:</span>
                                            <span>{{ mastery_data.total_questions }}å•</span>
                                        </div>
                                    </div>
                                    
                                    {% if mastery_data.improvement_trend > 0.05 %}
                                    <div class="mt-2">
                                        <small class="text-success">
                                            â¬†ï¸ æˆé•·ä¸­ (+{{ "%.1f"|format(mastery_data.improvement_trend * 100) }}%)
                                        </small>
                                    </div>
                                    {% elif mastery_data.improvement_trend < -0.05 %}
                                    <div class="mt-2">
                                        <small class="text-warning">
                                            â¬‡ï¸ è¦å¾©ç¿’ ({{ "%.1f"|format(mastery_data.improvement_trend * 100) }}%)
                                        </small>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- å­¦ç¿’æ¨å¥¨ -->
    {% if report.recommendations %}
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-success">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">ğŸ’¡ AIå­¦ç¿’æ¨å¥¨</h5>
                </div>
                <div class="card-body">
                    <!-- å„ªå…ˆéƒ¨é–€ -->
                    {% if report.recommendations.priority_departments %}
                    <div class="mb-4">
                        <h6>ğŸš© å„ªå…ˆå­¦ç¿’éƒ¨é–€:</h6>
                        {% for priority in report.recommendations.priority_departments %}
                        <div class="alert alert-{{ 'danger' if priority.accuracy < 0.5 else 'warning' if priority.accuracy < 0.7 else 'info' }}">
                            <strong>{{ priority.name }}</strong> (æ­£ç­”ç‡: {{ "%.1f"|format(priority.accuracy * 100) }}%)
                            <br><small>{{ priority.recommendation }}</small>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                    
                    <!-- å­¦ç¿’æˆ¦ç•¥ -->
                    {% if report.recommendations.study_strategy %}
                    <div class="mb-4">
                        <h6>ğŸ“‹ æ¨å¥¨å­¦ç¿’æˆ¦ç•¥:</h6>
                        <ul class="list-unstyled">
                            {% for strategy in report.recommendations.study_strategy %}
                            <li>â¡ï¸ {{ strategy }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                    
                    <!-- æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ— -->
                    {% if report.recommendations.next_steps %}
                    <div>
                        <h6>ğŸ“ˆ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:</h6>
                        <ol>
                            {% for step in report.recommendations.next_steps %}
                            <li>{{ step }}</li>
                            {% endfor %}
                        </ol>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- æ™‚ç³»åˆ—ãƒˆãƒ¬ãƒ³ãƒ‰ï¼ˆãƒãƒ£ãƒ¼ãƒˆç”¨ï¼‰ -->
    {% if report.time_series_analysis.weekly_trend %}
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5>ğŸ“ˆ å­¦ç¿’é€²æ—ãƒˆãƒ¬ãƒ³ãƒ‰</h5>
                </div>
                <div class="card-body">
                    <canvas id="weeklyTrendChart" height="100"></canvas>
                    <p class="text-muted mt-2">é€±æ¬¡ã®æ­£ç­”ç‡æ¨ç§»ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚å‚¾å‘: {{ report.time_series_analysis.trend_direction }}</p>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<!-- Chart.js ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// é€±æ¬¡ãƒˆãƒ¬ãƒ³ãƒ‰ãƒãƒ£ãƒ¼ãƒˆ
{% if report.time_series_analysis.weekly_trend %}
const weeklyData = {{ report.time_series_analysis.weekly_trend | tojson }};
const ctx = document.getElementById('weeklyTrendChart').getContext('2d');
new Chart(ctx, {
    type: 'line',
    data: {
        labels: weeklyData.map(d => d.week),
        datasets: [{
            label: 'æ­£ç­”ç‡',
            data: weeklyData.map(d => d.accuracy * 100),
            borderColor: 'rgb(75, 192, 192)',
            backgroundColor: 'rgba(75, 192, 192, 0.2)',
            tension: 0.1
        }]
    },
    options: {
        responsive: true,
        plugins: {
            title: {
                display: true,
                text: 'é€±æ¬¡æ­£ç­”ç‡ãƒˆãƒ¬ãƒ³ãƒ‰'
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                max: 100,
                ticks: {
                    callback: function(value) {
                        return value + '%';
                    }
                }
            }
        }
    }
});
{% endif %}
</script>

<style>
.border-left {
    border-left: 4px solid !important;
}

.card-header {
    border-radius: 0.375rem 0.375rem 0 0 !important;
}

.progress {
    height: 8px;
}

.badge-lg {
    font-size: 0.9rem;
    padding: 0.5rem 0.75rem;
}

@media (max-width: 768px) {
    .col-lg-6.col-xl-4 {
        margin-bottom: 1rem;
    }
}
</style>
{% endblock %}