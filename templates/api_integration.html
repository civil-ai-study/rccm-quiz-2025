<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIçµ±åˆãƒ»ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«æ©Ÿèƒ½ - RCCMå­¦ç¿’ã‚¢ãƒ—ãƒª</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .integration-card {
            transition: transform 0.2s, box-shadow 0.2s;
            border: none;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .integration-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }
        .api-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .certification-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        .reporting-card {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
        .organization-card {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
        }
        .tab-content {
            padding: 2rem 0;
        }
        .nav-pills .nav-link {
            border-radius: 25px;
            margin: 0 5px;
            font-weight: 500;
        }
        .nav-pills .nav-link.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .api-key-display {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            word-break: break-all;
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .status-active { background-color: #28a745; }
        .status-inactive { background-color: #dc3545; }
        .status-pending { background-color: #ffc107; }
        .progress-chart {
            height: 200px;
            margin: 20px 0;
        }
        .certification-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
            margin: 4px;
        }
        .cert-completed { background: #d4edda; color: #155724; }
        .cert-in-progress { background: #d1ecf1; color: #0c5460; }
        .cert-not-started { background: #f8d7da; color: #721c24; }
        .integration-step {
            padding: 20px;
            border-left: 4px solid #667eea;
            margin-bottom: 20px;
            background: #f8f9fa;
        }
        .report-preview {
            max-height: 400px;
            overflow-y: auto;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
        }
        .lms-logo {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            margin-right: 15px;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
            <div class="col-12">
                <nav class="navbar navbar-expand-lg navbar-light bg-light">
                    <div class="container">
                        <a class="navbar-brand" href="/">
                            ğŸ”Œ APIçµ±åˆãƒ»ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«æ©Ÿèƒ½
                        </a>
                        <div class="d-flex">
                            <a href="/" class="btn btn-outline-primary">
                                â¬…ï¸ ãƒ¡ã‚¤ãƒ³ã«æˆ»ã‚‹
                            </a>
                        </div>
                    </div>
                </nav>
            </div>
        </div>

        <div class="container mt-4">
            <!-- ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
            <ul class="nav nav-pills justify-content-center mb-4">
                <li class="nav-item">
                    <a class="nav-link active" href="#api-management" data-bs-toggle="pill">
                        ğŸ”‘ APIç®¡ç†
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#certifications" data-bs-toggle="pill">
                        ğŸ… èªå®šè¿½è·¡
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#reports" data-bs-toggle="pill">
                        ğŸ“Š é€²æ—ãƒ¬ãƒãƒ¼ãƒˆ
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#organizations" data-bs-toggle="pill">
                        ğŸ¢ çµ„ç¹”ç®¡ç†
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#integrations" data-bs-toggle="pill">
                        ğŸ”— å¤–éƒ¨é€£æº
                    </a>
                </li>
            </ul>

            <div class="tab-content">
                <!-- APIç®¡ç†ã‚¿ãƒ– -->
                <div class="tab-pane fade show active" id="api-management">
                    <div class="row mb-4">
                        <div class="col-md-8">
                            <h2>ğŸ”‘ APIç®¡ç†</h2>
                            <p class="text-muted">å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ é€£æºç”¨ã®APIã‚­ãƒ¼ã‚’ç®¡ç†ã—ã¾ã™</p>
                        </div>
                        <div class="col-md-4 text-end">
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createApiKeyModal">
                                â• æ–°è¦APIã‚­ãƒ¼ç”Ÿæˆ
                            </button>
                        </div>
                    </div>

                    <!-- APIæ¦‚è¦ -->
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="card integration-card api-card">
                                <div class="card-body text-center">
                                    ğŸ’»
                                    <h4>RESTful API</h4>
                                    <p>æ¨™æº–çš„ãªHTTP APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card integration-card">
                                <div class="card-body text-center">
                                    ğŸ›¡ï¸
                                    <h4>èªè¨¼ä¿è­·</h4>
                                    <p>APIã‚­ãƒ¼ãƒ™ãƒ¼ã‚¹ã®å®‰å…¨ãªèªè¨¼</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card integration-card">
                                <div class="card-body text-center">
                                    âš¡
                                    <h4>ãƒ¬ãƒ¼ãƒˆåˆ¶é™</h4>
                                    <p>1æ™‚é–“ã‚ãŸã‚Š1000ãƒªã‚¯ã‚¨ã‚¹ãƒˆ</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card integration-card">
                                <div class="card-body text-center">
                                    ğŸ“„
                                    <h4>JSONå½¢å¼</h4>
                                    <p>æ§‹é€ åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿äº¤æ›</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- æ—¢å­˜APIã‚­ãƒ¼ä¸€è¦§ -->
                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h5>ç™ºè¡Œæ¸ˆã¿APIã‚­ãƒ¼</h5>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>çµ„ç¹”å</th>
                                                    <th>APIã‚­ãƒ¼</th>
                                                    <th>æ¨©é™</th>
                                                    <th>ä½œæˆæ—¥</th>
                                                    <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                                                    <th>ä½¿ç”¨çŠ¶æ³</th>
                                                    <th>æ“ä½œ</th>
                                                </tr>
                                            </thead>
                                            <tbody id="api-keys-table">
                                                {% if api_keys %}
                                                    {% for key_info in api_keys %}
                                                    <tr>
                                                        <td>{{ key_info.organization }}</td>
                                                        <td>
                                                            <code class="small">{{ key_info.api_key[:20] }}...</code>
                                                            <button class="btn btn-sm btn-outline-secondary ms-2" onclick="copyApiKey('{{ key_info.api_key }}')">
                                                                ğŸ“‹
                                                            </button>
                                                        </td>
                                                        <td>
                                                            {% for permission in key_info.permissions %}
                                                                <span class="badge bg-secondary me-1">{{ permission }}</span>
                                                            {% endfor %}
                                                        </td>
                                                        <td>{{ key_info.created_at[:10] }}</td>
                                                        <td>
                                                            <span class="status-indicator status-{{ 'active' if key_info.is_active else 'inactive' }}"></span>
                                                            {{ 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–' if key_info.is_active else 'ç„¡åŠ¹' }}
                                                        </td>
                                                        <td>
                                                            <small>{{ key_info.usage_stats.total_requests }} ãƒªã‚¯ã‚¨ã‚¹ãƒˆ</small>
                                                        </td>
                                                        <td>
                                                            <button class="btn btn-sm btn-outline-danger" onclick="revokeApiKey('{{ key_info.api_key }}')">
                                                                ğŸš« ç„¡åŠ¹åŒ–
                                                            </button>
                                                        </td>
                                                    </tr>
                                                    {% endfor %}
                                                {% else %}
                                                    <tr>
                                                        <td colspan="7" class="text-center text-muted">
                                                            ã¾ã APIã‚­ãƒ¼ãŒç™ºè¡Œã•ã‚Œã¦ã„ã¾ã›ã‚“
                                                        </td>
                                                    </tr>
                                                {% endif %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- APIä½¿ç”¨ä¾‹ -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h5>APIä½¿ç”¨ä¾‹</h5>
                                </div>
                                <div class="card-body">
                                    <h6>ãƒ¦ãƒ¼ã‚¶ãƒ¼é€²æ—å–å¾—</h6>
                                    <pre class="bg-light p-3"><code>curl -X GET "https://your-domain.com/api/users/user123/progress" \
  -H "X-API-Key: your_api_key_here" \
  -H "Content-Type: application/json"</code></pre>
                                    
                                    <h6 class="mt-4">çµ„ç¹”ãƒ¬ãƒãƒ¼ãƒˆå–å¾—</h6>
                                    <pre class="bg-light p-3"><code>curl -X GET "https://your-domain.com/api/reports/organization/org456" \
  -H "X-API-Key: your_api_key_here" \
  -H "Content-Type: application/json"</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- èªå®šè¿½è·¡ã‚¿ãƒ– -->
                <div class="tab-pane fade" id="certifications">
                    <div class="row mb-4">
                        <div class="col-md-8">
                            <h2>ğŸ… èªå®šè¿½è·¡</h2>
                            <p class="text-muted">å­¦ç¿’è€…ã®èªå®šãƒ—ãƒ­ã‚°ãƒ©ãƒ é€²æ—ã‚’è¿½è·¡ãƒ»ç®¡ç†ã—ã¾ã™</p>
                        </div>
                        <div class="col-md-4 text-end">
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createCertificationModal">
                                â• èªå®šãƒ—ãƒ­ã‚°ãƒ©ãƒ ä½œæˆ
                            </button>
                        </div>
                    </div>

                    <!-- èªå®šãƒ—ãƒ­ã‚°ãƒ©ãƒ æ¦‚è¦ -->
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <div class="card integration-card certification-card">
                                <div class="card-body text-center">
                                    <h3>{{ certifications_summary.total_programs | default(0) }}</h3>
                                    <p>èªå®šãƒ—ãƒ­ã‚°ãƒ©ãƒ æ•°</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card integration-card">
                                <div class="card-body text-center">
                                    <h3>{{ certifications_summary.total_participants | default(0) }}</h3>
                                    <p>å‚åŠ è€…æ•°</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card integration-card">
                                <div class="card-body text-center">
                                    <h3>{{ "%.1f"|format(certifications_summary.completion_rate * 100 | default(0)) }}%</h3>
                                    <p>å®Œäº†ç‡</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- èªå®šãƒ—ãƒ­ã‚°ãƒ©ãƒ ä¸€è¦§ -->
                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h5>èªå®šãƒ—ãƒ­ã‚°ãƒ©ãƒ ä¸€è¦§</h5>
                                </div>
                                <div class="card-body">
                                    {% if certification_programs %}
                                        {% for program in certification_programs %}
                                        <div class="card mb-3">
                                            <div class="card-body">
                                                <div class="row align-items-center">
                                                    <div class="col-md-8">
                                                        <h5 class="card-title">{{ program.name }}</h5>
                                                        <p class="card-text">{{ program.description }}</p>
                                                        <div class="mb-2">
                                                            {% for req_name in program.requirements.keys() %}
                                                            <span class="badge bg-outline-primary me-1">{{ req_name }}</span>
                                                            {% endfor %}
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4 text-end">
                                                        <div class="mb-2">
                                                            <strong>å‚åŠ è€…:</strong> {{ program.statistics.total_participants }}äºº<br>
                                                            <strong>å®Œäº†è€…:</strong> {{ program.statistics.completed }}äºº
                                                        </div>
                                                        <button class="btn btn-outline-primary btn-sm" onclick="viewCertificationDetails('{{ program.id }}')">
                                                            è©³ç´°è¡¨ç¤º
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        {% endfor %}
                                    {% else %}
                                        <div class="alert alert-info">
                                            â„¹ï¸
                                            ã¾ã èªå®šãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒä½œæˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚æ–°ã—ã„ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- é€²æ—ãƒ¬ãƒãƒ¼ãƒˆã‚¿ãƒ– -->
                <div class="tab-pane fade" id="reports">
                    <div class="row mb-4">
                        <div class="col-md-8">
                            <h2>ğŸ“Š é€²æ—ãƒ¬ãƒãƒ¼ãƒˆ</h2>
                            <p class="text-muted">è©³ç´°ãªå­¦ç¿’é€²æ—ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆãƒ»ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã™</p>
                        </div>
                        <div class="col-md-4 text-end">
                            <div class="btn-group">
                                <button class="btn btn-primary dropdown-toggle" data-bs-toggle="dropdown">
                                    ğŸ“ ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="#" onclick="generateReport('individual')">å€‹äººãƒ¬ãƒãƒ¼ãƒˆ</a></li>
                                    <li><a class="dropdown-item" href="#" onclick="generateReport('organization')">çµ„ç¹”ãƒ¬ãƒãƒ¼ãƒˆ</a></li>
                                    <li><a class="dropdown-item" href="#" onclick="generateReport('comprehensive')">ç·åˆãƒ¬ãƒãƒ¼ãƒˆ</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- ãƒ¬ãƒãƒ¼ãƒˆç¨®é¡ -->
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <div class="card integration-card reporting-card">
                                <div class="card-body text-center">
                                    ğŸ‘¤
                                    <h4>å€‹äººãƒ¬ãƒãƒ¼ãƒˆ</h4>
                                    <p>å€‹åˆ¥å­¦ç¿’è€…ã®è©³ç´°åˆ†æ</p>
                                    <button class="btn btn-light btn-sm" onclick="showReportForm('individual')">
                                        ç”Ÿæˆã™ã‚‹
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card integration-card">
                                <div class="card-body text-center">
                                    ğŸ¢
                                    <h4>çµ„ç¹”ãƒ¬ãƒãƒ¼ãƒˆ</h4>
                                    <p>çµ„ç¹”å…¨ä½“ã®å­¦ç¿’çŠ¶æ³</p>
                                    <button class="btn btn-outline-info btn-sm" onclick="showReportForm('organization')">
                                        ç”Ÿæˆã™ã‚‹
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card integration-card">
                                <div class="card-body text-center">
                                    ğŸ“ˆ
                                    <h4>åˆ†æãƒ¬ãƒãƒ¼ãƒˆ</h4>
                                    <p>ãƒˆãƒ¬ãƒ³ãƒ‰ã¨æ”¹å–„ææ¡ˆ</p>
                                    <button class="btn btn-outline-success btn-sm" onclick="showReportForm('analytics')">
                                        ç”Ÿæˆã™ã‚‹
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ãƒ¬ãƒãƒ¼ãƒˆå±¥æ­´ -->
                    <div class="row">
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header">
                                    <h5>ç”Ÿæˆæ¸ˆã¿ãƒ¬ãƒãƒ¼ãƒˆ</h5>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>ãƒ¬ãƒãƒ¼ãƒˆå</th>
                                                    <th>ç¨®é¡</th>
                                                    <th>ç”Ÿæˆæ—¥æ™‚</th>
                                                    <th>å½¢å¼</th>
                                                    <th>æ“ä½œ</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% if generated_reports %}
                                                    {% for report in generated_reports %}
                                                    <tr>
                                                        <td>{{ report.name }}</td>
                                                        <td><span class="badge bg-secondary">{{ report.type }}</span></td>
                                                        <td>{{ report.generated_at }}</td>
                                                        <td>{{ report.format }}</td>
                                                        <td>
                                                            <button class="btn btn-sm btn-outline-primary" onclick="downloadReport('{{ report.id }}')">
                                                                ğŸ“
                                                            </button>
                                                        </td>
                                                    </tr>
                                                    {% endfor %}
                                                {% else %}
                                                    <tr>
                                                        <td colspan="5" class="text-center text-muted">
                                                            ã¾ã ãƒ¬ãƒãƒ¼ãƒˆãŒç”Ÿæˆã•ã‚Œã¦ã„ã¾ã›ã‚“
                                                        </td>
                                                    </tr>
                                                {% endif %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5>ãƒ¬ãƒãƒ¼ãƒˆè¨­å®š</h5>
                                </div>
                                <div class="card-body">
                                    <form id="reportSettingsForm">
                                        <div class="mb-3">
                                            <label class="form-label">æœŸé–“</label>
                                            <select class="form-select" name="time_period">
                                                <option value="week">ç›´è¿‘1é€±é–“</option>
                                                <option value="month" selected>ç›´è¿‘1ãƒ¶æœˆ</option>
                                                <option value="quarter">ç›´è¿‘3ãƒ¶æœˆ</option>
                                                <option value="year">ç›´è¿‘1å¹´</option>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">å‡ºåŠ›å½¢å¼</label>
                                            <select class="form-select" name="format">
                                                <option value="json">JSON</option>
                                                <option value="pdf">PDF</option>
                                                <option value="excel">Excel</option>
                                                <option value="csv">CSV</option>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" name="include_personal_data" aria-label="å€‹äººæƒ…å ±ã‚’å«ã‚ã‚‹">
                                                <label class="form-check-label">
                                                    å€‹äººãƒ‡ãƒ¼ã‚¿ã‚’å«ã‚ã‚‹
                                                </label>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- çµ„ç¹”ç®¡ç†ã‚¿ãƒ– -->
                <div class="tab-pane fade" id="organizations">
                    <div class="row mb-4">
                        <div class="col-md-8">
                            <h2>ğŸ¢ çµ„ç¹”ç®¡ç†</h2>
                            <p class="text-muted">ä¼æ¥­ãƒ»æ•™è‚²æ©Ÿé–¢ã®å­¦ç¿’ç®¡ç†ã‚’è¡Œã„ã¾ã™</p>
                        </div>
                        <div class="col-md-4 text-end">
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createOrganizationModal">
                                â• çµ„ç¹”è¿½åŠ 
                            </button>
                        </div>
                    </div>

                    <!-- çµ„ç¹”æ¦‚è¦ -->
                    <div class="row mb-4">
                        {% if organizations %}
                            {% for org in organizations %}
                            <div class="col-md-6 col-lg-4 mb-3">
                                <div class="card integration-card organization-card">
                                    <div class="card-body">
                                        <h5 class="card-title">{{ org.name }}</h5>
                                        <p class="card-text">{{ org.description[:100] }}...</p>
                                        <div class="row text-center">
                                            <div class="col-6">
                                                <h4>{{ org.statistics.total_users }}</h4>
                                                <small>ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°</small>
                                            </div>
                                            <div class="col-6">
                                                <h4>{{ "%.1f"|format(org.statistics.average_accuracy * 100) }}%</h4>
                                                <small>å¹³å‡æ­£ç­”ç‡</small>
                                            </div>
                                        </div>
                                        <div class="mt-3">
                                            <button class="btn btn-light btn-sm" onclick="viewOrganization('{{ org.id }}')">
                                                ç®¡ç†ç”»é¢
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="col-12">
                                <div class="alert alert-info">
                                    â„¹ï¸
                                    ã¾ã çµ„ç¹”ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚æ–°ã—ã„çµ„ç¹”ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚
                                </div>
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- å¤–éƒ¨é€£æºã‚¿ãƒ– -->
                <div class="tab-pane fade" id="integrations">
                    <div class="row mb-4">
                        <div class="col-md-8">
                            <h2>ğŸ”— å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ é€£æº</h2>
                            <p class="text-muted">LMSã‚„ä»–ã®å­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ ã¨ã®é€£æºã‚’è¨­å®šã—ã¾ã™</p>
                        </div>
                        <div class="col-md-4 text-end">
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#setupIntegrationModal">
                                â• é€£æºè¨­å®š
                            </button>
                        </div>
                    </div>

                    <!-- åˆ©ç”¨å¯èƒ½ãªé€£æº -->
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <div class="card integration-card">
                                <div class="card-body text-center">
                                    <div class="lms-logo bg-primary d-inline-flex align-items-center justify-content-center">
                                        ğŸ“
                                    </div>
                                    <h5>Moodle</h5>
                                    <p class="text-muted">ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹LMS</p>
                                    <button class="btn btn-outline-primary btn-sm">é€£æºè¨­å®š</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card integration-card">
                                <div class="card-body text-center">
                                    <div class="lms-logo bg-info d-inline-flex align-items-center justify-content-center">
                                        ğŸ¨
                                    </div>
                                    <h5>Canvas</h5>
                                    <p class="text-muted">ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ™ãƒ¼ã‚¹LMS</p>
                                    <button class="btn btn-outline-info btn-sm">é€£æºè¨­å®š</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card integration-card">
                                <div class="card-body text-center">
                                    <div class="lms-logo bg-dark d-inline-flex align-items-center justify-content-center">
                                        ğŸ“š
                                    </div>
                                    <h5>Blackboard</h5>
                                    <p class="text-muted">ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºLMS</p>
                                    <button class="btn btn-outline-dark btn-sm">é€£æºè¨­å®š</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- é€£æºè¨­å®šæ‰‹é † -->
                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h5>é€£æºè¨­å®šæ‰‹é †</h5>
                                </div>
                                <div class="card-body">
                                    <div class="integration-step">
                                        <h6>ğŸ”‘ ã‚¹ãƒ†ãƒƒãƒ— 1: APIã‚­ãƒ¼ç”Ÿæˆ</h6>
                                        <p>é€£æºã—ãŸã„å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ ç”¨ã®APIã‚­ãƒ¼ã‚’ç”Ÿæˆã—ã€é©åˆ‡ãªæ¨©é™ã‚’è¨­å®šã—ã¾ã™ã€‚</p>
                                    </div>
                                    <div class="integration-step">
                                        <h6>âš™ï¸ ã‚¹ãƒ†ãƒƒãƒ— 2: é€£æºè¨­å®š</h6>
                                        <p>å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ ã®æ¥ç¶šæƒ…å ±ã‚’è¨­å®šã—ã€ãƒ‡ãƒ¼ã‚¿åŒæœŸã®é »åº¦ã¨ã‚¿ã‚¤ãƒ—ã‚’æŒ‡å®šã—ã¾ã™ã€‚</p>
                                    </div>
                                    <div class="integration-step">
                                        <h6>ğŸ”„ ã‚¹ãƒ†ãƒƒãƒ— 3: åˆæœŸåŒæœŸ</h6>
                                        <p>è¨­å®šå®Œäº†å¾Œã€åˆæœŸåŒæœŸã‚’å®Ÿè¡Œã—ã¦ãƒ‡ãƒ¼ã‚¿ã®æ•´åˆæ€§ã‚’ç¢ºèªã—ã¾ã™ã€‚</p>
                                    </div>
                                    <div class="integration-step">
                                        <h6>âœ… ã‚¹ãƒ†ãƒƒãƒ— 4: å‹•ä½œç¢ºèª</h6>
                                        <p>å­¦ç¿’é€²æ—ãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ãåŒæœŸã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã—ã€é‹ç”¨ã‚’é–‹å§‹ã—ã¾ã™ã€‚</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- APIã‚­ãƒ¼ç”Ÿæˆãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal fade" id="createApiKeyModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">æ–°è¦APIã‚­ãƒ¼ç”Ÿæˆ</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="createApiKeyForm">
                        <div class="mb-3">
                            <label class="form-label">çµ„ç¹”å *</label>
                            <input type="text" class="form-control" name="organization" required aria-label="çµ„ç¹”åå…¥åŠ›æ¬„">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">æ¨©é™</label>
                            <div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="permissions" value="read_users" aria-label="ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®èª­ã¿å–ã‚Šæ¨©é™">
                                    <label class="form-check-label">ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±èª­ã¿å–ã‚Š</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="permissions" value="read_progress" aria-label="å­¦ç¿’é€²æ—ã®èª­ã¿å–ã‚Šæ¨©é™">
                                    <label class="form-check-label">é€²æ—ãƒ‡ãƒ¼ã‚¿èª­ã¿å–ã‚Š</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="permissions" value="generate_reports" aria-label="ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆæ¨©é™">
                                    <label class="form-check-label">ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="permissions" value="manage_certifications" aria-label="èªå®šç®¡ç†æ¨©é™">
                                    <label class="form-check-label">èªå®šç®¡ç†</label>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">æœ‰åŠ¹æœŸé™</label>
                            <select class="form-select" name="expires_in_days">
                                <option value="30">30æ—¥</option>
                                <option value="90">90æ—¥</option>
                                <option value="365" selected>1å¹´</option>
                                <option value="730">2å¹´</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    <button type="button" class="btn btn-primary" onclick="createApiKey()">ç”Ÿæˆ</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // APIã‚­ãƒ¼ç”Ÿæˆ
        function createApiKey() {
            const form = document.getElementById('createApiKeyForm');
            const formData = new FormData(form);
            
            // æ¨©é™é…åˆ—ã‚’ä½œæˆ
            const permissions = [];
            formData.getAll('permissions').forEach(permission => {
                permissions.push(permission);
            });
            
            const data = {
                organization: formData.get('organization'),
                permissions: permissions,
                expires_in_days: parseInt(formData.get('expires_in_days'))
            };
            
            fetch('/api/auth/generate_key', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('APIã‚­ãƒ¼ãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸï¼');
                    location.reload();
                } else {
                    alert('ã‚¨ãƒ©ãƒ¼: ' + data.error);
                }
            })
            .catch(error => {
                // API error (production mode)
                alert('APIã‚­ãƒ¼ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ');
            });
        }

        // APIã‚­ãƒ¼ã‚³ãƒ”ãƒ¼
        function copyApiKey(apiKey) {
            navigator.clipboard.writeText(apiKey).then(() => {
                alert('APIã‚­ãƒ¼ãŒã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã•ã‚Œã¾ã—ãŸ');
            });
        }

        // APIã‚­ãƒ¼ç„¡åŠ¹åŒ–
        function revokeApiKey(apiKey) {
            if (confirm('ã“ã®APIã‚­ãƒ¼ã‚’ç„¡åŠ¹åŒ–ã—ã¾ã™ã‹ï¼Ÿ')) {
                fetch('/api/auth/revoke_key', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({api_key: apiKey})
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('APIã‚­ãƒ¼ãŒç„¡åŠ¹åŒ–ã•ã‚Œã¾ã—ãŸ');
                        location.reload();
                    } else {
                        alert('ã‚¨ãƒ©ãƒ¼: ' + data.error);
                    }
                })
                .catch(error => {
                    // API error (production mode)
                    alert('APIã‚­ãƒ¼ç„¡åŠ¹åŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ');
                });
            }
        }

        // ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
        function generateReport(type) {
            const settings = new FormData(document.getElementById('reportSettingsForm'));
            const params = new URLSearchParams();
            
            for (let [key, value] of settings.entries()) {
                params.append(key, value);
            }
            
            fetch(`/api/reports/generate/${type}?${params}`, {
                method: 'GET'
            })
            .then(response => response.json())
            .then(data => {
                alert('ãƒ¬ãƒãƒ¼ãƒˆãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸ');
                location.reload();
            })
            .catch(error => {
                // API error (production mode)
                alert('ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ');
            });
        }

        // èªå®šè©³ç´°è¡¨ç¤º
        function viewCertificationDetails(certId) {
            window.open(`/api/certifications/${certId}`, '_blank');
        }

        // çµ„ç¹”è¡¨ç¤º
        function viewOrganization(orgId) {
            window.open(`/api/organizations/${orgId}`, '_blank');
        }

        // ãƒ¬ãƒãƒ¼ãƒˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        function downloadReport(reportId) {
            window.open(`/api/reports/download/${reportId}`, '_blank');
        }

        // ãƒ¬ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ãƒ è¡¨ç¤º
        function showReportForm(type) {
            // å®Ÿè£…: ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆãƒ•ã‚©ãƒ¼ãƒ ã‚’è¡¨ç¤º
        }
    </script>
</body>
</html>