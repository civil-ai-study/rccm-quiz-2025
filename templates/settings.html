{% extends 'base.html' %}
{% block title %}è¨­å®š | RCCMè©¦é¨“å•é¡Œé›†{% endblock %}
{% block content %}
<div class="container my-4">
  <!-- ãƒšãƒ¼ã‚¸ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <div class="text-center mb-4">
    <div class="d-flex align-items-center justify-content-center mb-3">
      <a href="/" class="btn btn-outline-secondary me-3">
        â¬…ï¸ ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹
      </a>
      <h1 class="mb-0">
        âš™ï¸ è¨­å®š
      </h1>
    </div>
    <p class="text-muted">å­¦ç¿’è¨­å®šã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã¾ã™</p>
  </div>

  <!-- ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ 'success' if category == 'success' else 'danger' }} alert-dismissible fade show" role="alert">
          {% if category == 'success' %}âœ…{% else %}âš ï¸{% endif %}
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <!-- è¨­å®šãƒ•ã‚©ãƒ¼ãƒ  -->
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card border-primary">
        <div class="card-header text-white text-center" style="background-color: var(--primary-color)">
          <h5 class="mb-0">ğŸ¯ å•é¡Œæ•°è¨­å®š</h5>
        </div>
        <div class="card-body">
          <form method="POST">
            <!-- å•é¡Œæ•°é¸æŠ -->
            <div class="mb-4">
              <label class="form-label"><strong>1ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚ãŸã‚Šã®å•é¡Œæ•°</strong></label>
              <p class="text-muted small">å­¦ç¿’ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§å‡ºé¡Œã•ã‚Œã‚‹å•é¡Œæ•°ã‚’é¸æŠã—ã¦ãã ã•ã„</p>
              
              <div class="row g-3">
                {% for option in available_options %}
                <div class="col-md-4">
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="questions_per_session" 
                           value="{{ option }}" id="questions_{{ option }}"
                           {% if current_questions == option %}checked{% endif %}>
                    <label class="form-check-label w-100" for="questions_{{ option }}">
                      <div class="card h-100 {% if current_questions == option %}border-success bg-light{% else %}border-secondary{% endif %}">
                        <div class="card-body text-center">
                          <h4 class="text-primary">{{ option }}å•</h4>
                          <div class="mt-2">
                            {% if option == 10 %}
                              <small class="text-muted">æ¨™æº–ãƒ»çŸ­æ™‚é–“å­¦ç¿’</small>
                              <div>ğŸ•°ï¸ ç´„15-20åˆ†</div>
                            {% elif option == 20 %}
                              <small class="text-muted">ã—ã£ã‹ã‚Šå­¦ç¿’</small>
                              <div>ğŸ•°ï¸ ç´„30-40åˆ†</div>
                            {% elif option == 30 %}
                              <small class="text-muted">é›†ä¸­ç‰¹è¨“</small>
                              <div>ğŸ•°ï¸ ç´„45-60åˆ†</div>
                            {% endif %}
                          </div>
                        </div>
                      </div>
                    </label>
                  </div>
                </div>
                {% endfor %}
              </div>
            </div>

            <!-- ç¾åœ¨ã®è¨­å®šè¡¨ç¤º -->
            <div class="alert alert-info mb-4">
              â„¹ï¸
              <strong>ç¾åœ¨ã®è¨­å®š:</strong> {{ current_questions }}å•/ã‚»ãƒƒã‚·ãƒ§ãƒ³
            </div>

            <!-- æ³¨æ„äº‹é … -->
            <div class="alert alert-warning mb-4">
              <h6>âš ï¸ è¨­å®šå¤‰æ›´ã«ã¤ã„ã¦</h6>
              <ul class="mb-0">
                <li>è¨­å®šå¤‰æ›´ã¯æ¬¡å›ã®å­¦ç¿’ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‹ã‚‰é©ç”¨ã•ã‚Œã¾ã™</li>
                <li>ç¾åœ¨é€²è¡Œä¸­ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ã¯å½±éŸ¿ã—ã¾ã›ã‚“</li>
                <li>å•é¡Œæ•°ãŒå¤šã„ã»ã©ã€ã‚ˆã‚Šå¹…åºƒã„ç¯„å›²ã®å­¦ç¿’ãŒã§ãã¾ã™</li>
                <li>çŸ­æ™‚é–“ã§é›†ä¸­ã—ãŸã„å ´åˆã¯10å•ã€ã˜ã£ãã‚Šå­¦ç¿’ã—ãŸã„å ´åˆã¯20-30å•ãŒãŠã™ã™ã‚ã§ã™</li>
              </ul>
            </div>

            <!-- é€ä¿¡ãƒœã‚¿ãƒ³ -->
            <div class="text-center">
              <button type="submit" class="btn btn-success btn-lg px-5">
                ğŸ’¾ è¨­å®šã‚’ä¿å­˜
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- è¡¨ç¤ºè¨­å®š -->
  <div class="row justify-content-center mt-4">
    <div class="col-md-8">
      <div class="card border-primary">
        <div class="card-header text-white text-center" style="background-color: var(--primary-color)">
          <h5 class="mb-0">ğŸ‘ï¸ è¡¨ç¤ºè¨­å®š</h5>
        </div>
        <div class="card-body">
          <!-- æ–‡å­—ã‚µã‚¤ã‚ºé¸æŠ -->
          <div class="mb-4">
            <label class="form-label"><strong>æ–‡å­—ã‚µã‚¤ã‚º</strong></label>
            <p class="text-muted small">èª­ã¿ã‚„ã™ã•ã«åˆã‚ã›ã¦æ–‡å­—ã‚µã‚¤ã‚ºã‚’é¸æŠã—ã¦ãã ã•ã„</p>

            <div class="btn-group w-100 font-size-selector" role="group" aria-label="æ–‡å­—ã‚µã‚¤ã‚ºé¸æŠ">
              <input type="radio" class="btn-check" name="fontSize" id="fs-standard" value="standard" autocomplete="off">
              <label class="btn btn-outline-primary" for="fs-standard">
                <div class="text-center">
                  <div style="font-size: 16px;">A</div>
                  <small>æ¨™æº–</small>
                </div>
              </label>

              <input type="radio" class="btn-check" name="fontSize" id="fs-large" value="large" autocomplete="off">
              <label class="btn btn-outline-primary" for="fs-large">
                <div class="text-center">
                  <div style="font-size: 20px;">A</div>
                  <small>å¤§ãã‚</small>
                </div>
              </label>

              <input type="radio" class="btn-check" name="fontSize" id="fs-extra-large" value="extra-large" autocomplete="off">
              <label class="btn btn-outline-primary" for="fs-extra-large">
                <div class="text-center">
                  <div style="font-size: 24px;">A</div>
                  <small>ç‰¹å¤§</small>
                </div>
              </label>
            </div>

            <div class="alert alert-info mt-3 mb-0">
              â„¹ï¸ è¨­å®šã—ãŸæ–‡å­—ã‚µã‚¤ã‚ºã¯å…¨ã¦ã®ãƒšãƒ¼ã‚¸ã«é©ç”¨ã•ã‚Œã¾ã™
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ãã®ä»–ã®è¨­å®šï¼ˆå°†æ¥æ‹¡å¼µç”¨ï¼‰ -->
  <div class="row justify-content-center mt-4">
    <div class="col-md-8">
      <div class="card border-light">
        <div class="card-header bg-light">
          <h6 class="mb-0">ğŸ”§ ãã®ä»–ã®è¨­å®šï¼ˆæº–å‚™ä¸­ï¼‰</h6>
        </div>
        <div class="card-body">
          <div class="row text-center">
            <div class="col-md-4">
              <div class="p-3 future-feature">
                ğŸ””
                <div><strong>é€šçŸ¥è¨­å®š</strong></div>
                <small>å­¦ç¿’ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼</small>
              </div>
            </div>
            <div class="col-md-4">
              <div class="p-3 future-feature">
                ğŸ“Š
                <div><strong>çµ±è¨ˆè¨­å®š</strong></div>
                <small>è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆè¡¨ç¤º</small>
              </div>
            </div>
            <div class="col-md-4">
              <div class="p-3 future-feature">
                ğŸ¯
                <div><strong>å­¦ç¿’ãƒ—ãƒ©ãƒ³</strong></div>
                <small>å€‹åˆ¥æœ€é©åŒ–</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.form-check-label .card {
  cursor: pointer;
  transition: all 0.3s ease;
}

.form-check-label .card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.form-check-input:checked + .form-check-label .card {
  border-color: var(--success-color) !important;
  background-color: #e8f5e8 !important;
  box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
}

.future-feature {
  opacity: 0.6;
  border: 1px dashed #ccc;
  border-radius: 8px;
  background-color: #f8f9fa;
}

[data-theme="dark"] .future-feature {
  background-color: var(--card-bg);
  border-color: var(--border-color);
}

[data-theme="dark"] .form-check-input:checked + .form-check-label .card {
  background-color: #1e3c2f !important;
  border-color: var(--success-color) !important;
}
</style>

<script>
// ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯å‡¦ç†ã‚’æ”¹å–„
document.querySelectorAll('.form-check-label').forEach(label => {
  label.addEventListener('click', function() {
    // å°‘ã—é…å»¶ã‚’ã¤ã‘ã¦ã‚¹ã‚¿ã‚¤ãƒ«æ›´æ–°
    setTimeout(() => {
      document.querySelectorAll('.form-check-label .card').forEach(card => {
        card.classList.remove('border-success', 'bg-light');
        card.classList.add('border-secondary');
      });

      const checkedInput = document.querySelector('input[name="questions_per_session"]:checked');
      if (checkedInput) {
        const checkedCard = checkedInput.nextElementSibling.querySelector('.card');
        checkedCard.classList.remove('border-secondary');
        checkedCard.classList.add('border-success', 'bg-light');
      }
    }, 10);
  });
});

// æ–‡å­—ã‚µã‚¤ã‚ºåˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½
document.querySelectorAll('[name="fontSize"]').forEach(radio => {
  radio.addEventListener('change', (e) => {
    const size = e.target.value;
    document.body.setAttribute('data-font-size', size);
    localStorage.setItem('fontSize', size);

    // å¤‰æ›´ã‚’è¦–è¦šçš„ã«ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
    const alert = document.createElement('div');
    alert.className = 'alert alert-success alert-dismissible fade show position-fixed top-0 start-50 translate-middle-x mt-3';
    alert.style.zIndex = '9999';
    alert.innerHTML = `
      âœ… æ–‡å­—ã‚µã‚¤ã‚ºã‚’ã€Œ${size === 'standard' ? 'æ¨™æº–' : size === 'large' ? 'å¤§ãã‚' : 'ç‰¹å¤§'}ã€ã«å¤‰æ›´ã—ã¾ã—ãŸ
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    document.body.appendChild(alert);
    setTimeout(() => alert.remove(), 3000);
  });
});

// ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«è¨­å®šã‚’å¾©å…ƒ
window.addEventListener('DOMContentLoaded', () => {
  const savedSize = localStorage.getItem('fontSize') || 'standard';
  document.body.setAttribute('data-font-size', savedSize);
  const savedRadio = document.getElementById('fs-' + savedSize);
  if (savedRadio) {
    savedRadio.checked = true;
  }
});
</script>
{% endblock %}