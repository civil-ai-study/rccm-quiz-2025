{
  "timestamp": "2025-07-12T10:56:13.661152",
  "overview": {
    "app_py_structure": {
      "total_functions": 246,
      "total_routes": 158,
      "key_routes": [
        "/health_simple",
        "/",
        "/set_user",
        "/change_user",
        "/force_refresh",
        "/exam",
        "/exam/next",
        "/result",
        "/statistics",
        "/department_statistics",
        "/departments",
        "/departments/<department_id>",
        "/departments/<department_id>/types",
        "/departments/<department_id>/types/<question_type>/categories",
        "/department_study",
        "/department_study/<department>",
        "/categories",
        "/review",
        "/api/review/count",
        "/api/review/questions",
        "/api/review/remove",
        "/api/review/bulk_remove",
        "/srs_stats",
        "/api/data/export",
        "/api/cache/clear",
        "/api/cache/stats",
        "/reset",
        "/force_reset",
        "/debug/soil_test",
        "/debug/urban_test",
        "/debug/all_departments",
        "/help",
        "/settings",
        "/debug",
        "/api/bookmark",
        "/api/bookmarks",
        "/bookmark",
        "/bookmarks",
        "/api/bookmark",
        "/exam/review",
        "/debug/create_review_data",
        "/debug/clear_session",
        "/debug/session",
        "/debug/set_current",
        "/achievements",
        "/study_calendar",
        "/api/gamification/status",
        "/ai_analysis",
        "/adaptive_questions",
        "/adaptive_quiz",
        "/integrated_learning",
        "/integrated_learning_selection",
        "/learner_insights",
        "/api/difficulty/status",
        "/learning_optimization",
        "/api/learning/realtime_tracking",
        "/api/learning/biorhythm",
        "/api/learning/optimal_schedule",
        "/api/ai_analysis",
        "/learning_plan",
        "/exam_simulator",
        "/start_exam/basic",
        "/start_exam/foundation",
        "/start_exam/<exam_type>",
        "/exam_question",
        "/submit_exam_answer",
        "/flag_exam_question",
        "/exam_navigation",
        "/finish_exam",
        "/exam_results",
        "/advanced_statistics",
        "/api/exam_status",
        "/api/log_error",
        "/api/mobile/manifest",
        "/api/mobile/offline/save",
        "/api/mobile/offline/sync",
        "/api/mobile/voice/settings",
        "/api/mobile/touch/settings",
        "/api/mobile/question/<int:question_id>",
        "/api/mobile/cache/questions",
        "/api/mobile/performance",
        "/mobile_settings",
        "/manifest.json",
        "/sw.js",
        "/favicon.ico",
        "/icon-<size>.png",
        "/social_learning",
        "/leaderboard",
        "/health_check",
        "/api/system/file_handles",
        "/api/system/memory_status",
        "/api/system/optimize_memory",
        "/api/system/performance_status",
        "/api/system/performance_clear_cache",
        "/api/system/performance_rebuild_index",
        "/manual_test_dashboard",
        "/manual_test_guide",
        "/api/manual_test/monitoring_status",
        "/api/manual_test/quality_check",
        "/ai_dashboard",
        "/advanced_analytics",
        "/admin",
        "/admin/api/overview",
        "/admin/api/questions",
        "/admin/api/users",
        "/admin/api/users/<user_id>",
        "/admin/api/content",
        "/admin/api/performance",
        "/admin/api/reports/<report_type>",
        "/admin/api/refresh",
        "/social",
        "/social/create_group",
        "/social/join_group",
        "/social/leave_group",
        "/social/create_discussion",
        "/social/discussion/<discussion_id>",
        "/social/peer_comparison",
        "/social/leaderboard",
        "/social/study_partners",
        "/api_integration",
        "/api/auth/generate_key",
        "/api/auth/validate_key",
        "/api/auth/revoke_key",
        "/api/users",
        "/api/users/<user_id>/progress",
        "/api/users/<user_id>/certifications",
        "/api/reports/progress",
        "/api/reports/organization/<org_id>",
        "/api/reports/export/<format>",
        "/api/certifications",
        "/api/certifications/<cert_id>/progress",
        "/api/organizations",
        "/api/organizations/<org_id>/users",
        "/api/personalization/profile/<user_id>",
        "/api/personalization/recommendations/<user_id>",
        "/api/personalization/ui/<user_id>",
        "/api/enterprise/users",
        "/api/enterprise/user/<user_name>/report",
        "/enterprise/dashboard",
        "/api/enterprise/data/integrity",
        "/api/enterprise/cache/stats",
        "/api/enterprise/cache/clear",
        "/study/basic",
        "/study/specialist/<department>",
        "/enterprise_dashboard",
        "/health",
        "/api/error_prevention/status",
        "/api/error_prevention/reset_session",
        "/api/error_prevention/cleanup",
        "/api/session/status",
        "/api/session/extend",
        "/review_wrong",
        "/review_list",
        "/srs_review",
        "/stats",
        "/exam_department/<department_name>",
        "/departments_list",
        "/debug/session_info"
      ],
      "imports": [
        "datetime",
        "collections",
        "typing",
        "functools",
        "decimal",
        "flask",
        "utils",
        "config"
      ],
      "new_implementation": {
        "csv_japanese_categories": true,
        "get_department_questions_ultrasync": true,
        "exam_department_ultrasync": true,
        "departments_list_ultrasync": true
      },
      "file_size": 468142,
      "line_count": 11484
    },
    "utils_py_structure": {
      "key_functions_available": {
        "load_basic_questions_only": true,
        "load_specialist_questions_only": true,
        "load_questions_improved": true,
        "validate_file_path": true
      },
      "redis_integration": true,
      "file_size": 40747
    },
    "data_layer_structure": {
      "basic_csv": true,
      "specialist_csv_count": 12,
      "specialist_years": [
        "2008",
        "2009",
        "2010",
        "2011",
        "2012",
        "2013",
        "2014",
        "2015",
        "2016",
        "2017",
        "2018",
        "2019"
      ],
      "all_data_files": [
        "4-1.csv",
        "4-1.csv.backup_answer_case_fix_20250709_114403",
        "4-2_2008.csv",
        "4-2_2008.csv.backup_answer_case_fix_20250709_114403",
        "4-2_2009.csv",
        "4-2_2009.csv.backup_answer_case_fix_20250709_114403",
        "4-2_2010.csv",
        "4-2_2010.csv.backup_answer_case_fix_20250709_114403",
        "4-2_2011.csv",
        "4-2_2011.csv.backup_answer_case_fix_20250709_114404",
        "4-2_2012.csv",
        "4-2_2012.csv.backup_answer_case_fix_20250709_114404",
        "4-2_2013.csv",
        "4-2_2013.csv.backup_answer_case_fix_20250709_114404",
        "4-2_2013.csv.backup_category_fix_20250629",
        "4-2_2014.csv",
        "4-2_2014.csv.backup_answer_case_fix_20250709_114404",
        "4-2_2015.csv",
        "4-2_2015.csv.backup_answer_case_fix_20250709_114404",
        "4-2_2016.csv",
        "4-2_2016.csv.backup_answer_case_fix_20250709_114404",
        "4-2_2016.csv.backup_id_fix_20250706_214013",
        "4-2_2017.csv",
        "4-2_2017.csv.backup_answer_case_fix_20250709_114404",
        "4-2_2018.csv",
        "4-2_2018.csv.backup_answer_case_fix_20250709_114404",
        "4-2_2019.csv",
        "4-2_2019.csv.backup_answer_case_fix_20250709_114404",
        "analyze_categories.py",
        "analyze_categories_detailed.py",
        "backup_20250616_211637",
        "category_standardization_20250616_211732.log",
        "category_standardization_report.txt",
        "historical_success_analysis_20250709.md",
        "questions.csv.backup",
        "standardize_categories.py",
        "__pycache__"
      ],
      "actual_categories": [
        "道路",
        "共通"
      ]
    },
    "session_management": {
      "lightweight_session_manager": true,
      "session_state_manager": true,
      "memory_storage": true,
      "session_clear_usage": 3,
      "session_modified_usage": 87
    },
    "route_mapping": {
      "important_routes": {
        "/exam": true,
        "/start_exam": true,
        "/exam_department": true,
        "/departments_list": true,
        "/result": true
      },
      "all_exam_routes": [
        "/exam",
        "/exam/next",
        "/exam/review",
        "/exam_simulator",
        "/start_exam/basic",
        "/start_exam/foundation",
        "/start_exam/<exam_type>",
        "/exam_question",
        "/submit_exam_answer",
        "/flag_exam_question",
        "/exam_navigation",
        "/finish_exam",
        "/exam_results",
        "/api/exam_status",
        "/exam_department/<department_name>"
      ],
      "route_conflicts": [
        "競合可能性: /exam vs /exam/next",
        "競合可能性: /exam vs /exam/review",
        "競合可能性: /exam vs /exam_simulator",
        "競合可能性: /exam vs /exam_question",
        "競合可能性: /exam vs /exam_navigation",
        "競合可能性: /exam vs /exam_results",
        "競合可能性: /exam vs /exam_department/<department_name>"
      ]
    },
    "existing_functions": {
      "exam": true,
      "start_exam": true,
      "load_questions_from_lightweight_session": true,
      "safe_post_processing": true
    }
  },
  "detailed_analysis": {
    "new_function_integration": {
      "uses_existing_utils": true,
      "uses_existing_session_manager": true,
      "uses_existing_memory_storage": true,
      "redirects_to_existing_exam": true
    },
    "csv_category_mapping": {
      "mapping_count": 13,
      "basic_subject_mapped": true,
      "specialist_subjects_count": 12,
      "japanese_only": true,
      "sample_mappings": [
        [
          "基礎科目",
          "共通"
        ],
        [
          "道路",
          "道路"
        ],
        [
          "河川・砂防",
          "河川、砂防及び海岸・海洋"
        ],
        [
          "都市計画",
          "都市計画及び地方計画"
        ],
        [
          "造園",
          "造園"
        ]
      ]
    },
    "error_handling": {
      "try_except_blocks": 1,
      "specific_exceptions": 1,
      "error_template_usage": true,
      "logger_error_usage": true,
      "validation_checks": 7
    },
    "logging_consistency": {
      "overall_logging": {
        "logger.info": 410,
        "logger.error": 312,
        "logger.warning": 170,
        "logger.debug": 17
      },
      "new_implementation_logging": {
        "info_logs": 17,
        "error_logs": 8,
        "warning_logs": 3,
        "uses_emoji_prefixes": true
      }
    },
    "session_integration": {
      "session_assignments": 4,
      "session_modified_set": true,
      "lightweight_session_usage": true,
      "memory_storage_usage": true,
      "existing_session_vars_used": [
        "exam_id",
        "exam_question_ids",
        "exam_current"
      ],
      "compatible_with_existing": true
    }
  },
  "side_effects_check": {
    "import_conflicts": {
      "duplicate_imports": {},
      "total_imports": 20,
      "utils_imports": 0
    },
    "function_name_conflicts": {
      "duplicate_functions": {
        "safe_file_operation": 2,
        "decorated_function": 2,
        "get_session_lock": 2,
        "cleanup_session_locks": 2,
        "decorator": 2
      },
      "total_functions": 246,
      "new_function_conflicts": []
    },
    "variable_name_conflicts": {
      "global_variables": 38,
      "new_variable_conflicts": [],
      "csv_categories_defined": true
    },
    "session_variable_conflicts": {
      "session_variables": {
        "s_type": 2,
        "s_dept": 1,
        "s_current": 5,
        "s_start": 4,
        "history": 6,
        "exam_question_ids": 36,
        "exam_current": 37,
        "advanced_srs": 4,
        "request_history": 1,
        "srs_data": 1,
        "category_stats": 6,
        "user_name": 1,
        "user_id": 1,
        "base_user_id": 1,
        "session_id": 2,
        "login_time": 1,
        "exam_category": 22,
        "selected_question_type": 28,
        "selected_department": 11,
        "quiz_answered": 1,
        "bookmarks": 14,
        "review_session_restored": 1,
        "review_session_minimal": 1,
        "progress_tracking": 1,
        "progress_repair_count": 1,
        "exam_index_repair": 1,
        "exam_progress_timestamp": 1,
        "last_answered_question_id": 1,
        "total_questions_in_session": 1,
        "quiz_settings": 4,
        "selected_year": 4,
        "review_completed": 1,
        "department": 1,
        "adaptive_mode": 2,
        "foundation_mastery": 1,
        "birth_date": 1,
        "specialist_error": 1,
        "debug_info": 1,
        "category_filter": 1,
        "difficulty_filter": 1,
        "year_filter": 1,
        "exam_session": 13,
        "exam_id": 4,
        "exam_session_emergency": 1,
        "exam_type": 2,
        "config": 1,
        "flagged_questions": 1,
        "answers": 1,
        "current_question": 2,
        "_initialized": 1,
        "results": 1,
        "exam_history": 2,
        "start_time": 1,
        "status": 1,
        "questions": 1,
        "last_activity": 1,
        "department_name": 1
      },
      "new_session_variables": [
        "department_name"
      ],
      "session_usage_count": 246
    },
    "route_parameter_conflicts": {
      "parametered_routes": [
        "/departments/<department_id>",
        "/departments/<department_id>/types",
        "/departments/<department_id>/types/<question_type>/categories",
        "/department_study/<department>",
        "/start_exam/<exam_type>",
        "/api/mobile/question/<int:question_id>",
        "/icon-<size>.png",
        "/admin/api/users/<user_id>",
        "/admin/api/reports/<report_type>",
        "/social/discussion/<discussion_id>",
        "/api/users/<user_id>/progress",
        "/api/users/<user_id>/certifications",
        "/api/reports/organization/<org_id>",
        "/api/reports/export/<format>",
        "/api/certifications/<cert_id>/progress",
        "/api/organizations/<org_id>/users",
        "/api/personalization/profile/<user_id>",
        "/api/personalization/recommendations/<user_id>",
        "/api/personalization/ui/<user_id>",
        "/api/enterprise/user/<user_name>/report",
        "/study/specialist/<department>",
        "/exam_department/<department_name>"
      ],
      "new_route_conflicts": [
        "/departments/<department_id>",
        "/departments/<department_id>/types",
        "/departments/<department_id>/types/<question_type>/categories",
        "/department_study/<department>",
        "/study/specialist/<department>"
      ]
    },
    "memory_management_issues": {
      "store_exam_data_calls": 5,
      "memory_decorator_usage": 5,
      "session_clear_calls": 3,
      "gc_collect_calls": 1
    }
  },
  "improvement_recommendations": [
    {
      "priority": "高",
      "category": "ルート競合",
      "issue": "ルート競合が検出されました: ['競合可能性: /exam vs /exam/next', '競合可能性: /exam vs /exam/review', '競合可能性: /exam vs /exam_simulator', '競合可能性: /exam vs /exam_question', '競合可能性: /exam vs /exam_navigation', '競合可能性: /exam vs /exam_results', '競合可能性: /exam vs /exam_department/<department_name>']",
      "recommendation": "競合するルートの整理またはルートパターンの変更を検討してください。",
      "action": "ルート設計の見直し"
    },
    {
      "priority": "高",
      "category": "関数名重複",
      "issue": "関数名の重複: {'safe_file_operation': 2, 'decorated_function': 2, 'get_session_lock': 2, 'cleanup_session_locks': 2, 'decorator': 2}",
      "recommendation": "重複する関数名を一意な名前に変更してください。",
      "action": "関数名の変更"
    },
    {
      "priority": "中",
      "category": "エラーハンドリング",
      "issue": "新実装でのエラーハンドリングが不十分",
      "recommendation": "包括的なtry-catch文とエラーログを追加してください。",
      "action": "エラーハンドリングの強化"
    }
  ]
}