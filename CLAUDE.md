## 🎯 最終デバッグシナリオ（最優先実行）

### 元々の問題と解決方針
- **根本問題**: 4-2専門分野の問題混在（13部門で他部門問題が出題）
- **軽量版目的**: 専門分野分離修正 → 動作確認 → 完全版統合
- **現在状況**: ローカル軽量版起動中、専門分野分離テスト実行中

### 実行中のシナリオ
1. **Phase 1**: 軽量版専門分野分離テスト（各部門個別確認）
2. **Phase 2**: 問題発見時の修正実行
3. **Phase 3**: 動作確認後の完全版統合

### 🔧 正しい機能仕様（重要）

#### 機能1: 部門別問題
- **例**: 道路部門選択
- **動作**: 全年度の4-2_YYYY.csvファイルから道路カテゴリー問題を全て収集
- **出題**: 収集した問題からランダムで10問選択

#### 機能2: 年度別問題  
- **例**: 道路部門 + 2019年選択
- **動作**: 4-2_2019.csvファイルから道路カテゴリー問題のみ抽出（約30問）
- **出題**: その30問の中からランダムで10問選択

#### データ構造
- CSVファイル: `id,category,year,question,option_a,option_b,option_c,option_d,correct_answer,explanation,reference,difficulty`
- 部門フィルタリング: `row['category'] == '道路'` でマッチング

### 成功基準
- 全13部門で正しい専門分野問題のみ出題
- 問題混在ゼロ
- 10問完走成功

**📋 詳細シナリオ**: `FINAL_DEBUG_SCENARIO.md` 参照

### 🔥 重要な問題解決記録（2025年8月1日）

#### ❌ 1ヶ月間動かなかった根本原因
- **問題**: 日本語部門名（「道路」「河川」等）のURL文字化け
- **現象**: `/quiz/道路` → `���H` に変換され、CSVデータとマッチ不可
- **影響**: 全13部門で専門問題が表示されない致命的エラー

#### ✅ 解決策: 部門IDシステム実装
```
部門ID → 日本語名マッピング:
- road → 道路
- river → 河川、砂防及び海岸・海洋  
- urban → 都市計画及び地方計画
- tunnel → トンネル
（全13部門対応）
```

#### ✅ 動作確認済み機能
1. **部門別問題抽出**: 全年度4-2_YYYY.csvから該当部門問題を収集
   - 道路部門: 368問（2008-2019年）
   - 河川部門: 380問
   - トンネル部門: 339問
2. **ランダム問題選択**: 収集した問題からランダム選択機能
3. **CSV正常読み込み**: UTF-8エンコーディングで全ファイル正常処理

#### 📝 技術仕様確定
- **URLルート**: `/quiz/<部門ID>` (例: `/quiz/road`)
- **データ処理**: `row['category'] == '道路'` でフィルタリング
- **ファイル対象**: data/4-2_*.csv（全年度対応）
- **問題選択**: `random.sample()` でランダム選択

#### 🚨 重要な教訓
- CSVファイルは正常（勝手に修正しない）
- 問題はプログラムのURL処理部分
- 日本語URL回避のため英数字ID使用が効果的

---

## Execution Memories

- Executed within Claude Code
- Command used: `/model`

## CLI Tools Memories

- Installed npm package `clipimage`
- Installation command: `npm install -g clipimage`
- Usage: Run `clipimage` to save screenshot as `image_YYYY-MM-DD_HH-mm-ss.png`